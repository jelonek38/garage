<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status LoRa</title>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .card { background: #1e293b; padding: 20px; border-radius: 12px; margin: 10px; min-width: 200px; text-align: center; border-bottom: 4px solid #38bdf8; }
        .val { font-size: 2.5rem; font-weight: bold; display: block; }
        .label { color: #94a3b8; text-transform: uppercase; font-size: 0.8rem; }
        #status { margin-top: 20px; font-size: 0.7rem; color: #475569; }
    </style>
</head>
<body>

    <h1>GARAŻ LIVE</h1>
    
    <div class="card">
        <span class="label">Moc (RSSI)</span>
        <span id="rssi" class="val">--</span>
    </div>
    <div class="card">
        <span class="label">Jakość (SNR)</span>
        <span id="snr" class="val">--</span>
    </div>
    <div class="card">
        <span class="label">Pakiet</span>
        <span id="pakiet" class="val">--</span>
    </div>

    <div id="status">Inicjalizacja...</div>

    <script>
        // SPRAWDŹ TO DOKŁADNIE W LINKU DO FEEDU NA ADAFRUIT!
        const user = "S_K_"; 

        async function getData() {
            const feeds = ['rssi', 'snr', 'pakiet'];
            
            for (const f of feeds) {
                try {
                    // Próbujemy pobrać dane z najbardziej bezpośredniego adresu API
                    const url = `https://io.adafruit.com/api/v2/${user}/feeds/${f}/data/last`;
                    const r = await fetch(url);
                    
                    if (!r.ok) {
                        console.error(`Błąd dla ${f}: ${r.status}`);
                        document.getElementById('status').innerText = `Nie znaleziono feedu: ${f}. Sprawdź nazwę użytkownika i klucze.`;
                        continue;
                    }

                    const d = await r.json();
                    document.getElementById(f).innerText = d.value;
                    document.getElementById('status').innerText = "Aktualizacja: " + new Date().toLocaleTimeString();
                } catch (err) {
                    document.getElementById('status').innerText = "Błąd połączenia z API";
                }
            }
        }

        setInterval(getData, 15000);
        getData();
    </script>
</body>
</html>
